# Claude Context - PII De-Identification Pipeline

**Last Updated:** 2025-12-02
**Status:** DESIGN COMPLETE ✅ → Ready for Implementation

---

## Project in 30 Seconds

Build privacy-preserving pipeline to remove fake PII (days, months, colors, cities, states) from 40 conversational audio recordings + transcripts. Use forced alignment (aeneas) for precise word-level audio muting. Dataset downloadable from HuggingFace.

**Assignment:** Data Engineer take-home (2-4 hour timebox)

---

## Current Status

```
✅ COMPLETED (1.5 hours):
   - Dataset exploration (~30 min)
   - System design (~45 min)
   - Documentation reorganization (~15 min)

⏳ NEXT: Implementation (~3 hours)
```

---

## File Structure & What to Read

### Essential Files (Read in Order)

1. **`.claude.md`** ← You are here! (AI context, 2 min read)
2. **`README.md`** - Human quick start (5 min read)
3. **`SYSTEM_DESIGN.md`** - Complete technical design (15-20 min read, **READ THIS FIRST FOR DEEP DIVE**)
4. **`TODO.md`** - Implementation checklist with priorities (5 min read)

### Configuration & Setup

- `config.yaml` - PII categories (days, months, colors, cities, states)
- `requirements.txt` - Python dependencies (pandas, aeneas, soundfile, etc.)
- `projectbackground.txt` - Original assignment requirements

### Reference (Optional)

- `docs/archive/` - Detailed design docs (requirements, architecture, schemas)

---

## Key Discoveries from Exploration

### What We Found ✅

**Dataset:** `Appenlimited/1000h-us-english-smartphone-conversation`

- 40 conversations (WAV audio files)
- Transcripts **already exist** with timestamps!
- Format: `[0.000]` `<Speaker_1>` text `[3.500]` more text
- Metadata CSV with speaker demographics

**PII Presence (Verified in 3 samples):**
- ✅ Cities: Dallas, Houston, San Antonio, New York
- ✅ States: Texas, New York
- ✅ Days: Friday
- ✅ Months: January, June
- ❌ Colors: Not found (but 4/5 categories is sufficient)

**Critical Insight:** Having pre-existing transcripts with timestamps saves 2+ hours and avoids privacy risks!

---

## Key Decisions Made

| Decision | Choice | Why? |
|----------|--------|------|
| **Transcripts** | Use existing | Already have timestamps, saves time |
| **Word timing** | Forced alignment (aeneas) | Privacy-preserving, precise, local processing |
| **PII detection** | Pattern matching (regex) | Simple, configurable, sufficient for fake PII |
| **Audio redaction** | Mute segments | Simplest, clear indication |
| **Output format** | FLAC audio, JSON transcripts, Parquet metadata | Standard, efficient |

---

## System Architecture (5 Stages)

```
[1] Ingest
    Download 40 files from HuggingFace → organize locally

[2] Parse
    Parse `[timestamp]` format → structured JSON segments

[3] Align
    Forced alignment (aeneas) → word-level timestamps

[4] Detect PII
    Pattern matching → find cities, states, days, months, colors

[5] De-Identify
    - Text: Replace PII with tags ([CITY], [STATE], etc.)
    - Audio: Mute PII segments using word timestamps

[6] QA & Verify
    - Check no PII remains
    - Generate statistics
    - Create spot-check samples

[7] Package
    Organize as sellable dataset → FLAC audio + JSON + Parquet
```

---

## Why Forced Alignment (aeneas)?

**Problem:** Need to know WHEN each PII word was spoken in audio

**Bad Approach:** Use Whisper to transcribe
❌ Sends audio (with PII) to transcription system → privacy violation!

**Good Approach:** Forced alignment
✅ Uses transcript we already have
✅ Figures out timing WITHOUT sending PII anywhere
✅ Runs 100% locally
✅ Privacy-preserving

**Tool:** aeneas - easy install, fast, good enough accuracy

---

## Implementation Plan (TODO.md for details)

### Priority 1: Core Pipeline (~70 min)
1. Ingestion module - Download & organize (20 min)
2. Transcript parser - Parse `[timestamp]` format (15 min)
3. PII detector - Pattern matching (20 min)
4. Text de-ID - Replace with tags (15 min)

### Priority 2: Audio De-ID (~60 min)
5. Forced alignment - aeneas wrapper (30 min)
6. Audio modifier - Mute segments (30 min)

### Priority 3: QA & Packaging (~45 min)
7. Verification - Check no PII remains (20 min)
8. QA reports - Stats & spot checks (15 min)
9. Dataset packaging - Organize outputs (15 min)

**Total:** ~3 hours

---

## Code Structure to Create

```
src/
├── __init__.py
├── main.py                    # Pipeline orchestrator
│
├── ingestion/
│   ├── __init__.py
│   ├── downloader.py          # HuggingFace download
│   └── organizer.py           # File organization
│
├── parsing/
│   ├── __init__.py
│   └── transcript_parser.py   # Parse [timestamp] format
│
├── deid/
│   ├── __init__.py
│   ├── pii_detector.py        # Pattern matching
│   └── text_redactor.py       # Text replacement
│
├── audio/
│   ├── __init__.py
│   ├── forced_aligner.py      # aeneas wrapper
│   └── audio_modifier.py      # Mute segments
│
├── qa/
│   ├── __init__.py
│   ├── verifier.py            # Check PII removal
│   └── statistics.py          # Generate stats
│
└── utils/
    ├── __init__.py
    ├── logger.py              # Logging
    └── progress.py            # Progress bar
```

---

## When Starting New Session

1. **Read this file** (`.claude.md`) - 2 min for full context
2. **Check TODO.md** - See current task
3. **Ask user:** "Where should we continue?" or "Ready to implement [next module]?"
4. **If unclear:** Read SYSTEM_DESIGN.md sections 1-4 (overview, findings, architecture)

---

## Quick Reference

**Dataset:** `Appenlimited/1000h-us-english-smartphone-conversation` (HuggingFace)
**Size:** 40 conversations
**Input:** WAV audio + TXT transcripts + CSV metadata
**Output:** FLAC audio + JSON transcripts + Parquet metadata + QA reports
**Time Budget:** 2-4 hours total (design done, ~3h for implementation)
**Working Dir:** `/Users/vinayakgrover/gosumoai`

---

## Common Commands

```bash
# Setup
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# Run pipeline (once implemented)
python -m src.main

# Run specific module
python -m src.ingestion.downloader
python -m src.parsing.transcript_parser
```

---

## Important Notes

- **Privacy First:** Never send PII to external APIs
- **Local Processing:** All alignment done locally with aeneas
- **Configurable:** PII categories in config.yaml
- **Scalable:** Architecture supports 40 → 10,000+ conversations
- **Time-boxed:** 2-4 hours total, prioritize must-haves

---

## If User Says "Continue" or "Let's Code"

1. Check TODO.md Priority 1
2. Start with ingestion module (first uncompleted task)
3. Build incrementally, test as you go
4. Update TODO.md as tasks complete

---

**TIP FOR CLAUDE:** This project is well-designed! Trust the SYSTEM_DESIGN.md. Follow TODO.md priorities. Ask clarifying questions if user wants to deviate from plan.

---

**Last Context:** User wants clean, efficient documentation. New developer should understand everything in 25 minutes. You should have full context from this file alone.
